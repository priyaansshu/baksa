{"ast":null,"code":"var _jsxFileName = \"/Users/priyanshumodi/Desktop/Code/React/dot/client/src/Game.js\",\n    _s = $RefreshSig$();\n\nimport logo from './logo.svg';\nimport './App.css';\nimport react, { useState, useEffect, useRef } from 'react';\nimport \"./style.css\";\nimport Dot from './Components/Dot';\nimport Grid from './Components/Grid';\nimport GameOver from './Components/GameOver';\nimport Header from './Components/Header';\nimport { io } from \"socket.io-client\";\nimport { ToastContainer, toast } from 'react-toastify';\nimport { css } from \"glamor\";\nimport Chat from './Components/Chat';\nimport { Route, Link, Routes, Navigate, useNavigate } from \"react-router-dom\";\nimport { useBeforeunload } from 'react-beforeunload';\nimport useScreenType from \"react-screentype-hook\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst socket = io('https://baksa19.herokuapp.com/', {\n  transports: ['websocket']\n}); // const socket = io('http://localhost:4000');\n\nexport default function Game(props) {\n  _s();\n\n  var i, j;\n  var tempBoxCount = 0;\n  var compTempPos;\n  var compBoxFlag = false;\n  var comp2line = false;\n  const [elMap, setMap] = useState(new Map());\n  const [boxMap, setBoxMap] = useState(new Map());\n  const [mapFlag, setMapFlag] = useState(true); //used to make sure the map is initialised only once\n\n  const [boxFlag, setBoxFlag] = useState(true); //used to make sure the box map is initialised only once\n\n  var red = \"#c5183b\";\n  var blue = \"#3b919b\";\n  const assignedColor = props.playerRole == 1 ? red : blue;\n  const [turn, setTurn] = useState(red);\n  const [redScore, setRedScore] = useState(0);\n  const [blueScore, setBlueScore] = useState(0);\n  const [gameOver, setGameOver] = useState(false);\n  var position;\n  const [tempId, setTempId] = useState(\"\");\n  const [tempColor, setTempColor] = useState(\"\");\n  const [finalRoomId, setFinalRoomId] = useState(\"\");\n  const [messageArr, setMessageArr] = useState([]);\n  const [showChat, setShowChat] = useState(false);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [lastSeen, setLastSeen] = useState(0);\n  const chatRef = useRef();\n  const gridRef = useRef();\n  const chatButtonRef = useRef();\n  const yourTurnRef = useRef();\n  const [gameLeaveWinner, setGameLeaveWinner] = useState(\"none\");\n  const [playerLeft, setPlayerLeft] = useState(false);\n  const [playerOnMobile, setPlayerOnMobile] = useState();\n  const [opponentOnMobile, setOpponentOnMobile] = useState();\n  const [locationKeys, setLocationKeys] = useState([]);\n  const screenType = useScreenType();\n  const history = useNavigate();\n  var localTurn;\n  const [movesArr, setMovesArr] = useState([]);\n  const [showLastMove, setShowLastMove] = useState(false);\n  var t; // variable for temporarily handling id\n\n  var tempTurn; // variable for temporarily handling turn\n\n  var tempBoxColor = \"\"; // var tempTimeoutId;\n\n  useEffect(() => {\n    var curUrl = JSON.stringify(window.location.href);\n\n    if (curUrl.substring(curUrl.length - 8, curUrl.length - 1) == \"offline\") {\n      props.setVsComp(true);\n    }\n  }, []);\n  useEffect(() => {\n    console.log(props.socketId);\n    var tempRoomId = props.roomId + \"1\";\n    socket.emit(\"rejoin\", {\n      roomId: tempRoomId\n    });\n  }, []);\n  useEffect(() => {\n    socket.on(\"final-room\", _ref => {\n      let {\n        roomId\n      } = _ref;\n      setFinalRoomId(roomId);\n    });\n  }, [socket]);\n\n  function updateMapWithServer() {\n    socket.emit(\"update\", {\n      turn: tempTurn,\n      roomId: finalRoomId,\n      socketId: props.socketId,\n      position: position,\n      tempId: t,\n      tempBoxColor: tempBoxColor\n    });\n  }\n\n  useEffect(() => {\n    // console.log(socket);\n    socket.on(\"updated\", data => {\n      position = data.position;\n      tempBoxColor = data.tempBoxColor;\n      var tempMovesArr = [...movesArr];\n      tempMovesArr.push(data.tempId);\n      setMovesArr(tempMovesArr);\n      updateLocalVariablesWithServerValues(data.tempId, data.turn);\n      elementCheckUtilityFunction(position, data.tempId);\n    });\n  }, [socket]);\n\n  function updateLocalVariablesWithServerValues(tempId, tempColor) {\n    setTempId(tempId);\n    setTempColor(tempColor);\n    localTurn = tempColor;\n  }\n\n  (function initMap() {\n    if (mapFlag) {\n      var tempGridSize;\n      var curUrl = JSON.stringify(window.location.href);\n\n      if (props.playerRole == 2) {\n        if (curUrl[curUrl.length - 1] == '/') {\n          if (curUrl[curUrl.length - 2] != '8') {\n            tempGridSize = 4;\n          } else {\n            tempGridSize = 8;\n          }\n        } else {\n          if (curUrl[curUrl.length - 1] != '8') {\n            tempGridSize = 4;\n          } else {\n            tempGridSize = 8;\n          }\n        }\n      }\n\n      if (props.playerRole == 1) {\n        var tempSize = props.gridSize == 4 ? 65 : 225;\n      } else {\n        var tempSize = tempGridSize == 4 ? 65 : 225;\n      }\n\n      for (i = 0; i < tempSize; ++i) {\n        elMap.set(i, \"unclicked\");\n      }\n\n      setMapFlag(false);\n    }\n  })();\n\n  (function initBoxMap() {\n    if (boxFlag) {\n      var tempGridSize;\n      var curUrl = JSON.stringify(window.location.href);\n\n      if (props.playerRole == 2) {\n        if (curUrl[curUrl.length - 1] == '/') {\n          if (curUrl[curUrl.length - 2] != '8') {\n            tempGridSize = 4;\n          } else {\n            tempGridSize = 8;\n          }\n        } else {\n          if (curUrl[curUrl.length - 1] != '8') {\n            tempGridSize = 4;\n          } else {\n            tempGridSize = 8;\n          }\n        }\n      }\n\n      if (props.playerRole == 1) {\n        var tempSize = props.gridSize;\n      } else {\n        var tempSize = tempGridSize;\n      }\n\n      for (i = 1; i <= tempSize; ++i) {\n        for (j = 1; j <= tempSize; ++j) boxMap.set(\"b-\" + i + \"-\" + j, \"transparent\");\n      }\n\n      setBoxFlag(false);\n    }\n  })();\n\n  function updateMap(position) {\n    if (elMap.get(position) !== \"clicked\") {\n      setMap(elMap.set(position, \"clicked\")); // console.log(elMap);\n    }\n  }\n\n  function elementCheckUtilityFunction(position, id) {\n    // console.log(\"here\");\n    updateMap(position);\n    setTurnFunc();\n\n    if (id.charAt(0) == \"h\") {\n      checkVerticalBoxes(id);\n    } else {\n      checkHorizontalBoxes(id);\n    }\n  }\n\n  function elementCheck(id) {\n    // console.log(tempTimeoutId)\n    // if(yourTurnRef.current.style.display===\"flex\"){\n    //   yourTurnRef.current.style.display = \"none\"\n    // }\n    // if(tempTimeoutId){\n    //   clearTimeout(tempTimeoutId);\n    // }\n    if (props.vsComp) {\n      var tempMovesArr = [...movesArr];\n      tempMovesArr.push(id);\n      setMovesArr(tempMovesArr);\n    } // console.log(elMap);\n\n\n    t = id;\n    tempBoxColor = \"\";\n    position = calcPosition(id); // console.log(position);\n\n    elementCheckUtilityFunction(position, id);\n    tempTurn = turn;\n    if (!props.vsComp) updateMapWithServer();\n  }\n\n  function calcPosition(id) {\n    var part1 = 0,\n        part2 = 0,\n        position = 0;\n\n    if (id.charAt(0) == \"d\") {\n      part1 = 14 * (parseInt(id.charAt(2)) - 1);\n      part2 = 2 * parseInt(id.charAt(4)) - 2;\n    } else if (id.charAt(0) == \"h\") {\n      part1 = 14 * (parseInt(id.charAt(2)) - 1);\n      part2 = 2 * parseInt(id.charAt(4)) - 1;\n    } else {\n      part1 = 14 * parseInt(id.charAt(2)) - 5;\n      part2 = parseInt(id.charAt(4));\n    }\n\n    position = part1 + part2; // console.log(position);\n\n    return position;\n  }\n\n  function setTurnFunc() {\n    setTurn(turn => turn === red ? blue : red); // console.log(\"In the setTurn function: \"+turn);\n  }\n\n  function stayTurn(boxColor) {\n    setTurn(boxColor);\n  }\n\n  function checkVerticalBoxes(id) {\n    // console.log(id);\n    var id1, id2, id3, id4, id5, id6;\n    var pos1, pos2, pos3, pos4, pos5, pos6;\n    var n = parseInt(id.charAt(2)),\n        m = parseInt(id.charAt(4));\n    id1 = \"h-\" + (n - 1) + \"-\" + m;\n    id2 = \"h-\" + (n + 1) + \"-\" + m;\n    id3 = \"v-\" + (n - 1) + \"-\" + m;\n    id4 = \"v-\" + (n - 1) + \"-\" + (m + 1);\n    id5 = \"v-\" + n + \"-\" + m;\n    id6 = \"v-\" + n + \"-\" + (m + 1);\n    pos1 = calcPosition(id1);\n    pos2 = calcPosition(id2);\n    pos3 = calcPosition(id3);\n    pos4 = calcPosition(id4);\n    pos5 = calcPosition(id5);\n    pos6 = calcPosition(id6);\n\n    if (tempBoxColor == \"\") {\n      var boxColor = turn;\n    } else {\n      var boxColor = tempBoxColor;\n    }\n\n    if (elMap.get(pos1) == \"clicked\" && elMap.get(pos2) == \"clicked\" && elMap.get(pos3) == \"clicked\" && elMap.get(pos4) == \"clicked\" && elMap.get(pos5) == \"clicked\" && elMap.get(pos6) == \"clicked\") {\n      // console.log(\"upper and lower boxes filled\");\n      setBoxMap(boxMap.set(\"b-\" + (n - 1) + \"-\" + m, boxColor));\n      setBoxMap(boxMap.set(\"b-\" + n + \"-\" + m, boxColor));\n      stayTurn(boxColor);\n      updateScore(\"b-\" + (n - 1) + \"-\" + m);\n      updateScore(\"b-\" + n + \"-\" + m);\n      updateTotal();\n    } else if (elMap.get(pos1) == \"clicked\" && elMap.get(pos3) == \"clicked\" && elMap.get(pos4) == \"clicked\") {\n      // console.log(\"upper box filled\");\n      setBoxMap(boxMap.set(\"b-\" + (n - 1) + \"-\" + m, boxColor));\n      stayTurn(boxColor);\n      updateScore(\"b-\" + (n - 1) + \"-\" + m);\n      updateTotal();\n    } else if (elMap.get(pos2) == \"clicked\" && elMap.get(pos5) == \"clicked\" && elMap.get(pos6) == \"clicked\") {\n      // console.log(\"lower box filled\");\n      setBoxMap(boxMap.set(\"b-\" + n + \"-\" + m, boxColor));\n      stayTurn(boxColor);\n      updateScore(\"b-\" + n + \"-\" + m);\n      updateTotal();\n    } // console.log(boxMap);\n\n\n    tempBoxColor = boxColor;\n  }\n\n  function checkHorizontalBoxes(id) {\n    // console.log(id);\n    var id1, id2, id3, id4, id5, id6;\n    var pos1, pos2, pos3, pos4, pos5, pos6;\n    var n = parseInt(id.charAt(2)),\n        m = parseInt(id.charAt(4));\n    id1 = \"h-\" + n + \"-\" + (m - 1);\n    id2 = \"v-\" + n + \"-\" + (m - 1);\n    id3 = \"h-\" + (n + 1) + \"-\" + (m - 1);\n    id4 = \"h-\" + n + \"-\" + m;\n    id5 = \"v-\" + n + \"-\" + (m + 1);\n    id6 = \"h-\" + (n + 1) + \"-\" + m;\n    pos1 = calcPosition(id1);\n    pos2 = calcPosition(id2);\n    pos3 = calcPosition(id3);\n    pos4 = calcPosition(id4);\n    pos5 = calcPosition(id5);\n    pos6 = calcPosition(id6);\n\n    if (tempBoxColor == \"\") {\n      var boxColor = turn;\n    } else {\n      var boxColor = tempBoxColor;\n    }\n\n    if (elMap.get(pos1) == \"clicked\" && elMap.get(pos2) == \"clicked\" && elMap.get(pos3) == \"clicked\" && elMap.get(pos4) == \"clicked\" && elMap.get(pos5) == \"clicked\" && elMap.get(pos6) == \"clicked\") {\n      // console.log(\"left and right boxes filled\");\n      setBoxMap(boxMap.set(\"b-\" + n + \"-\" + (m - 1), boxColor));\n      setBoxMap(boxMap.set(\"b-\" + n + \"-\" + m, boxColor));\n      stayTurn(boxColor);\n      updateScore(\"b-\" + n + \"-\" + (m - 1));\n      updateScore(\"b-\" + n + \"-\" + m);\n      updateTotal();\n    } else if (elMap.get(pos1) == \"clicked\" && elMap.get(pos2) == \"clicked\" && elMap.get(pos3) == \"clicked\") {\n      // console.log(\"left box filled\");\n      setBoxMap(boxMap.set(\"b-\" + n + \"-\" + (m - 1), boxColor));\n      stayTurn(boxColor);\n      updateScore(\"b-\" + n + \"-\" + (m - 1));\n      updateTotal();\n    } else if (elMap.get(pos4) == \"clicked\" && elMap.get(pos5) == \"clicked\" && elMap.get(pos6) == \"clicked\") {\n      // console.log(\"right box filled\");\n      setBoxMap(boxMap.set(\"b-\" + n + \"-\" + m, boxColor));\n      stayTurn(boxColor);\n      updateScore(\"b-\" + n + \"-\" + m);\n      updateTotal();\n    } // console.log(boxMap);\n\n\n    tempBoxColor = boxColor;\n  }\n\n  function updateScore(tempBoxId) {\n    if (boxMap.get(tempBoxId) == red) {\n      setRedScore(redScore => redScore + 1);\n    } else if (boxMap.get(tempBoxId) == blue) {\n      setBlueScore(blueScore => blueScore + 1);\n    }\n  }\n\n  function updateTotal() {\n    tempBoxCount = 0;\n\n    for (const [key, value] of boxMap.entries()) {\n      if (value != \"transparent\") {\n        tempBoxCount++;\n      }\n    }\n\n    var tempGridSize;\n    var curUrl = JSON.stringify(window.location.href);\n\n    if (props.playerRole == 2) {\n      if (curUrl[curUrl.length - 1] == '/') {\n        if (curUrl[curUrl.length - 2] != '8') {\n          tempGridSize = 4;\n        } else {\n          tempGridSize = 8;\n        }\n      } else {\n        if (curUrl[curUrl.length - 1] != '8') {\n          tempGridSize = 4;\n        } else {\n          tempGridSize = 8;\n        }\n      }\n    }\n\n    if (props.playerRole == 1) {\n      if (props.gridSize == 4) {\n        if (tempBoxCount == 16) {\n          // console.log(boxMap);\n          console.log(\"gameover\");\n          setGameOver(true);\n        }\n      } else if (props.gridSize == 8) {\n        if (tempBoxCount == 64) {\n          setGameOver(true);\n        }\n      }\n    } else {\n      if (tempGridSize == 4) {\n        if (tempBoxCount == 16) {\n          console.log(\"gameover\");\n          setGameOver(true);\n        }\n      } else if (tempGridSize == 8) {\n        if (tempBoxCount == 64) {\n          setGameOver(true);\n        }\n      }\n    }\n\n    console.log(boxMap);\n  } // function compCheckVerticalBoxes(id, elRef){\n  //   // console.log(id);\n  //   var id1, id2, id3, id4, id5, id6;\n  //   var pos1, pos2, pos3, pos4, pos5, pos6;\n  //   var n = parseInt(id.charAt(2)), m = parseInt(id.charAt(4));\n  //   id1=\"h-\"+(n-1)+\"-\"+m;\n  //   id2=\"h-\"+(n+1)+\"-\"+m;\n  //   id3=\"v-\"+(n-1)+\"-\"+m;\n  //   id4=\"v-\"+(n-1)+\"-\"+(m+1);\n  //   id5=\"v-\"+(n)+\"-\"+m;\n  //   id6=\"v-\"+(n)+\"-\"+(m+1);\n  //   pos1=calcPosition(id1);\n  //   pos2=calcPosition(id2);\n  //   pos3=calcPosition(id3);\n  //   pos4=calcPosition(id4);\n  //   pos5=calcPosition(id5);\n  //   pos6=calcPosition(id6);\n  //   var boxColor = turn==blue?blue:red;\n  //   if(elMap.get(pos1)==\"clicked\" && elMap.get(pos2)== \"clicked\" && elMap.get(pos3)==\"clicked\" && elMap.get(pos4)== \"clicked\" && elMap.get(pos5)==\"clicked\" && elMap.get(pos6)== \"clicked\"){\n  //     compBoxFlag = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //     setBoxMap(boxMap.set((\"b-\"+(n-1)+\"-\"+m), boxColor));\n  //     setBoxMap(boxMap.set((\"b-\"+n+\"-\"+m), boxColor));\n  //     stayTurn();\n  //     updateScore((\"b-\"+(n-1)+\"-\"+m));\n  //     updateScore((\"b-\"+n+\"-\"+m));\n  //     updateTotal();\n  //   }\n  //   else if(elMap.get(pos1)==\"clicked\" && elMap.get(pos3)== \"clicked\" && elMap.get(pos4)==\"clicked\"){\n  //     compBoxFlag = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //     setBoxMap(boxMap.set((\"b-\"+(n-1)+\"-\"+m), boxColor));\n  //     stayTurn();\n  //     updateScore((\"b-\"+(n-1)+\"-\"+m));\n  //     updateTotal();\n  //   }\n  //   else if(elMap.get(pos2)== \"clicked\" && elMap.get(pos5)==\"clicked\" && elMap.get(pos6)== \"clicked\"){\n  //     compBoxFlag = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //     setBoxMap(boxMap.set((\"b-\"+n+\"-\"+m), boxColor));\n  //     stayTurn();\n  //     updateScore((\"b-\"+n+\"-\"+m));\n  //     updateTotal();\n  //   }\n  // }\n  // function compCheckHorizontalBoxes(id, elRef){\n  //   // console.log(id);\n  //   var id1, id2, id3, id4, id5, id6;\n  //   var pos1, pos2, pos3, pos4, pos5, pos6;\n  //   var n = parseInt(id.charAt(2)), m = parseInt(id.charAt(4));\n  //   id1=\"h-\"+(n)+\"-\"+(m-1);\n  //   id2=\"v-\"+(n)+\"-\"+(m-1);\n  //   id3=\"h-\"+(n+1)+\"-\"+(m-1);\n  //   id4=\"h-\"+(n)+\"-\"+(m);\n  //   id5=\"v-\"+(n)+\"-\"+(m+1);\n  //   id6=\"h-\"+(n+1)+\"-\"+(m);\n  //   pos1=calcPosition(id1);\n  //   pos2=calcPosition(id2);\n  //   pos3=calcPosition(id3);\n  //   pos4=calcPosition(id4);\n  //   pos5=calcPosition(id5);\n  //   pos6=calcPosition(id6);\n  //   var boxColor = turn==blue?blue:red;\n  //   if(elMap.get(pos1)==\"clicked\" && elMap.get(pos2)== \"clicked\" && elMap.get(pos3)==\"clicked\" && elMap.get(pos4)== \"clicked\" && elMap.get(pos5)==\"clicked\" && elMap.get(pos6)== \"clicked\"){\n  //     compBoxFlag = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //     setBoxMap(boxMap.set(\"b-\"+n+\"-\"+(m-1), boxColor));\n  //     setBoxMap(boxMap.set((\"b-\"+n+\"-\"+m), boxColor));\n  //     stayTurn();\n  //     updateScore((\"b-\"+n+\"-\"+(m-1)));\n  //     updateScore((\"b-\"+n+\"-\"+m));\n  //     updateTotal();\n  //   }\n  //   else if(elMap.get(pos1)==\"clicked\" && elMap.get(pos2)== \"clicked\" && elMap.get(pos3)==\"clicked\"){\n  //     compBoxFlag = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //     setBoxMap(boxMap.set(\"b-\"+n+\"-\"+(m-1), boxColor));\n  //     stayTurn();\n  //     updateScore((\"b-\"+n+\"-\"+(m-1)));\n  //     updateTotal();\n  //   }\n  //   else if(elMap.get(pos4)== \"clicked\" && elMap.get(pos5)==\"clicked\" && elMap.get(pos6)== \"clicked\"){\n  //     compBoxFlag = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //     setBoxMap(boxMap.set((\"b-\"+n+\"-\"+m), boxColor));\n  //     stayTurn();\n  //     updateScore((\"b-\"+n+\"-\"+m));\n  //     updateTotal();\n  //   }\n  // }\n  // function compCheck1lineHorizontal(id, elRef){\n  //   console.log(id);\n  //   var id1, id2, id3, id4, id5, id6;\n  //   var pos1, pos2, pos3, pos4, pos5, pos6;\n  //   var n = parseInt(id.charAt(2)), m = parseInt(id.charAt(4));\n  //   id1=\"h-\"+(n-1)+\"-\"+m;\n  //   id2=\"h-\"+(n+1)+\"-\"+m;\n  //   id3=\"v-\"+(n-1)+\"-\"+m;\n  //   id4=\"v-\"+(n-1)+\"-\"+(m+1);\n  //   id5=\"v-\"+(n)+\"-\"+m;\n  //   id6=\"v-\"+(n)+\"-\"+(m+1);\n  //   pos1=calcPosition(id1);\n  //   pos2=calcPosition(id2);\n  //   pos3=calcPosition(id3);\n  //   pos4=calcPosition(id4);\n  //   pos5=calcPosition(id5);\n  //   pos6=calcPosition(id6);\n  //   if(elMap.get(pos1)==\"clicked\" && elMap.get(pos3)== \"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos1)==\"clicked\" && elMap.get(pos4)== \"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   if(elMap.get(pos3)==\"clicked\" && elMap.get(pos4)== \"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos2)== \"clicked\" && elMap.get(pos5)==\"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos2)== \"clicked\" && elMap.get(pos6)==\"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos5)== \"clicked\" && elMap.get(pos6)==\"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  // }\n  // function compCheck1lineVertical(id, elRef){\n  //   console.log(id);\n  //   var id1, id2, id3, id4, id5, id6;\n  //   var pos1, pos2, pos3, pos4, pos5, pos6;\n  //   var n = parseInt(id.charAt(2)), m = parseInt(id.charAt(4));\n  //   id1=\"h-\"+(n)+\"-\"+(m-1);\n  //   id2=\"v-\"+(n)+\"-\"+(m-1);\n  //   id3=\"h-\"+(n+1)+\"-\"+(m-1);\n  //   id4=\"h-\"+(n)+\"-\"+(m);\n  //   id5=\"v-\"+(n)+\"-\"+(m+1);\n  //   id6=\"h-\"+(n+1)+\"-\"+(m);\n  //   pos1=calcPosition(id1);\n  //   pos2=calcPosition(id2);\n  //   pos3=calcPosition(id3);\n  //   pos4=calcPosition(id4);\n  //   pos5=calcPosition(id5);\n  //   pos6=calcPosition(id6);\n  //   if(elMap.get(pos1)==\"clicked\" && elMap.get(pos2)== \"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos1)==\"clicked\" && elMap.get(pos3)== \"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   if(elMap.get(pos2)==\"clicked\" && elMap.get(pos3)== \"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos4)== \"clicked\" && elMap.get(pos5)==\"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos4)== \"clicked\" && elMap.get(pos6)==\"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos5)== \"clicked\" && elMap.get(pos6)==\"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  // }\n  // function compFunc(elRef){\n  //   console.log(\"computer's turn\");\n  //   console.log(elMap);\n  //   compBoxFlag = false;\n  //   var comp1line = false;\n  //   var comp0line = false;\n  //   if(compBoxFlag == false){\n  //     // check box completion\n  //     console.log(\"check box completion\")\n  //     for(var i=1; i<=props.gridSize+1; ++i){\n  //       for(var j=1; j<=props.gridSize; ++j){\n  //         var compTempId1 = \"h-\"+[i]+\"-\"+[j];\n  //         var compTempId2 = \"v-\"+[j]+\"-\"+[i];\n  //         while(compBoxFlag == false){\n  //           if(elMap.get(calcPosition(compTempId1))!=\"clicked\"){\n  //             compCheckVerticalBoxes(compTempId1, elRef);\n  //           }\n  //           if(elMap.get(calcPosition(compTempId2))!=\"clicked\"){\n  //             compCheckHorizontalBoxes(compTempId2, elRef);\n  //           }\n  //         }\n  //       }\n  //     }\n  //   }\n  //   if(compBoxFlag == false && comp1line == false && comp0line == false){\n  //     // check 0 line clicked\n  //     console.log(\"check 0 line clicked\")\n  //     for(var i=1; i<=props.gridSize+1; ++i){\n  //       for(var j=1; j<=props.gridSize; ++j){\n  //         var compTempId1 = \"h-\"+[i]+\"-\"+[j];\n  //         var compTempId2 = \"v-\"+[j]+\"-\"+[i];\n  //         while(comp0line == false){\n  //           if(elMap.get(calcPosition(compTempId1))!=\"clicked\"){\n  //             comp0line = true;\n  //             compTempPos = calcPosition(compTempId1);\n  //             elMap.set(compTempPos, \"clicked\");\n  //             elRef.current.style.backgroundColor = blue;\n  //           }\n  //           if(elMap.get(calcPosition(compTempId2))!=\"clicked\"){\n  //             comp0line = true;\n  //             compTempPos = calcPosition(compTempId2);\n  //             elMap.set(compTempPos, \"clicked\");\n  //             elRef.current.style.backgroundColor = blue;\n  //           }\n  //         }  \n  //       }\n  //     }\n  //   }\n  // }\n\n\n  const playerColorToastId = useRef(null);\n  useEffect(() => {\n    var curUrl = JSON.stringify(window.location.href);\n    var tempVsComp;\n\n    if (curUrl.substring(curUrl.length - 8, curUrl.length - 1) == \"offline\") {\n      tempVsComp = true;\n    }\n\n    if (!tempVsComp && gridRef.current.className === \"show-grid\") {\n      var playerColor = assignedColor == \"#c5183b\" ? \"Red\" : \"Blue\";\n      playerColorToastId.current = toast(\"You are \" + playerColor, {\n        position: \"top-right\",\n        autoClose: 3000,\n        hideProgressBar: true,\n        closeOnClick: true,\n        pauseOnHover: false,\n        draggable: true,\n        progress: undefined\n      });\n    }\n  }, []);\n\n  function notTurnFunc() {\n    if (gridRef.current.className === \"show-grid\") {\n      toast(\"It's not your turn\", {\n        position: \"top-right\",\n        autoClose: 1000,\n        hideProgressBar: true,\n        closeOnClick: true,\n        pauseOnHover: false,\n        draggable: true,\n        progress: undefined\n      });\n    }\n  } // const yourTurnToastId = useRef(null);\n  // useEffect(()=>{\n  //   setTimeout(()=>{\n  //     console.log(gridRef.current.className)\n  //     if(assignedColor == turn && !props.vsComp && gridRef.current.className === \"show-grid\"){\n  //       if(yourTurnToastId.current!=null){\n  //         toast.dismiss(yourTurnToastId.current)\n  //       }\n  //       setTimeout(()=>{\n  //         yourTurnToastId.current = toast(\"It's your turn\", {\n  //           position: \"top-right\",\n  //           autoClose: 5000,\n  //           hideProgressBar: true,\n  //           closeOnClick: true,\n  //           pauseOnHover: false,\n  //           draggable: true,\n  //           progress: undefined,\n  //         }); \n  //       }, 5000)\n  //     }\n  //   } , 1000)\n  // }, [turn])\n\n\n  function sendMessage(tempMessage, playerRole) {\n    if (tempMessage == \"\") {\n      return;\n    }\n\n    socket.emit(\"send-message\", {\n      roomId: finalRoomId,\n      tempMessage: tempMessage,\n      playerRole: playerRole\n    });\n  }\n\n  socket.off(\"receive-message\");\n  socket.on(\"receive-message\", (tempMessage, playerRole) => {\n    // console.log(\"message received\");\n    const tempMessageArr = [...messageArr];\n    tempMessageArr.push({\n      sender: playerRole,\n      message: tempMessage\n    }); // console.log(tempMessageArr);\n\n    setMessageArr(tempMessageArr);\n  });\n  useEffect(() => {\n    if (showChat) {\n      setLastSeen(messageArr.length);\n      setUnreadCount(0);\n    }\n\n    var tempUnreadCount = messageArr.length - lastSeen;\n    setUnreadCount(tempUnreadCount);\n  }, [showChat]);\n  useEffect(() => {\n    if (showChat) {\n      setUnreadCount(0);\n      setLastSeen(messageArr.length);\n    } else {\n      var tempUnreadCount = messageArr.length - lastSeen;\n      setUnreadCount(tempUnreadCount);\n    }\n  }, [messageArr.length]);\n  useEffect(() => {\n    if (showChat) {\n      function handleClickOutside(event) {\n        if (chatRef.current && !chatRef.current.contains(event.target) && gridRef.current && !gridRef.current.contains(event.target) && chatButtonRef.current && !chatButtonRef.current.contains(event.target)) {\n          setShowChat(false);\n        }\n      }\n\n      document.addEventListener(\"mousedown\", handleClickOutside);\n      return () => {\n        document.removeEventListener(\"mousedown\", handleClickOutside);\n      };\n    }\n  }, [showChat]); // socket.off(\"game-left\");\n\n  useEffect(() => {\n    // console.log(gridRef.current.className);\n    if (!props.vsComp && gridRef.current.className === \"show-grid\") {\n      socket.on(\"game-left\", _ref2 => {\n        let {\n          winner\n        } = _ref2;\n        // console.log(\"The other player left the game\");\n        setPlayerLeft(true);\n        setGameOver(true);\n        setGameLeaveWinner(winner);\n      });\n    }\n  }, [socket]); // useEffect(()=>{\n  // console.log(\"playerLeft: \"+playerLeft);\n  // if(playerLeft){\n  //   clearInterval(intervalId);\n  // }\n  // }, [playerLeft])\n\n  useEffect(() => {\n    console.log(gridRef.current.className);\n\n    if (!props.vsComp && !playerLeft && gridRef.current.className === \"show-grid\") {\n      var tempRoomId = finalRoomId;\n\n      if (!playerLeft) {\n        const tempId = setInterval(() => {\n          // console.log(gridRef.current.className)\n          if (gridRef.current.className === \"show-grid\") {\n            socket.emit(\"game-leave-check\", {\n              playerRole: props.playerRole,\n              roomId: tempRoomId\n            });\n          }\n        }, 10000);\n      }\n    }\n  }, [finalRoomId, playerLeft]);\n  window.addEventListener('popstate', event => {\n    if (event.state) {\n      window.location.reload();\n    }\n  }, false);\n  useEffect(() => {\n    window.history.pushState({\n      name: \"browserBack\"\n    }, \"on browser back click\", window.location.href);\n    window.history.pushState({\n      name: \"browserBack\"\n    }, \"on browser back click\", window.location.href);\n  }, []);\n  useEffect(() => {\n    if (showLastMove) {\n      setTimeout(() => {\n        setShowLastMove(false);\n      });\n    }\n  }, [showLastMove]); // useEffect(()=>{\n  //   if(props.playerRole==2){\n  //     console.log(\"here1\")\n  //     if(props.gridSize == 4){\n  //       if(tempBoxCount == 1){\n  //         setGameOver(true);\n  //         console.log(\"here2\")\n  //       }\n  //     }\n  //     else if(props.gridSize == 8){\n  //       if(tempBoxCount == 64){\n  //         setGameOver(true);\n  //       }\n  //     }    \n  //   }\n  // }, [socket, boxMap])\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Header, {\n      gridSize: props.gridSize,\n      gameOver: gameOver,\n      fromMidGame: true,\n      vsComp: props.vsComp\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 891,\n      columnNumber: 7\n    }, this), !gameOver ? /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"last-move-button\",\n      onClick: () => {\n        setShowLastMove(true);\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 893,\n      columnNumber: 9\n    }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"center-container\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: !gameOver ? \"show-grid\" : \"hide-grid\",\n        ref: gridRef,\n        children: /*#__PURE__*/_jsxDEV(Grid, {\n          gridSize: props.gridSize,\n          func: elementCheck,\n          turn: turn,\n          map: elMap,\n          boxMap: boxMap,\n          vsComp: props.vsComp,\n          tempColor: tempColor,\n          tempId: tempId,\n          assignedColor: assignedColor,\n          notTurnFunc: notTurnFunc,\n          showLastMove: showLastMove,\n          setShowLastMove: setShowLastMove,\n          movesArr: movesArr\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 901,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 900,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: !gameOver ? \"hide-game-over\" : \"show-game-over\",\n        children: /*#__PURE__*/_jsxDEV(GameOver, {\n          gameLeaveWinner: gameLeaveWinner,\n          redScore: redScore,\n          blueScore: blueScore,\n          gridSize: props.gridSize,\n          boxMap: boxMap,\n          vsComp: props.vsComp,\n          gameOver: gameOver,\n          curRoomId: finalRoomId\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 919,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 918,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: !gameOver ? \"score-container\" : \"hide-score-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"score\",\n          id: turn == red ? \"turn-score-red\" : \"score-red\",\n          children: [\"Red: \", redScore]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 932,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"score\",\n          id: turn == blue ? \"turn-score-blue\" : \"score-blue\",\n          children: [\"Blue: \", blueScore]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 933,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 931,\n        columnNumber: 9\n      }, this), assignedColor == turn && !gameOver && !props.vsComp ? /*#__PURE__*/_jsxDEV(\"div\", {\n        className: assignedColor == \"#c5183b\" ? \"yourTurnText-red\" : \"yourTurnText-blue\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"baksa-image-container\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 937,\n          columnNumber: 13\n        }, this), \"It's your turn\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 936,\n        columnNumber: 11\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 899,\n      columnNumber: 7\n    }, this), !props.vsComp && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: assignedColor == red ? \"chat-button-container-red\" : \"chat-button-container-blue\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: chatButtonRef,\n        className: \"chat-button\",\n        onClick: () => {\n          setShowChat(!showChat);\n        },\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"unread-count-container\",\n          style: {\n            visibility: unreadCount == 0 ? \"hidden\" : \"visible\"\n          },\n          children: unreadCount\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 949,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 945,\n        columnNumber: 7\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 944,\n      columnNumber: 21\n    }, this), !props.vsComp && /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: chatRef,\n      children: /*#__PURE__*/_jsxDEV(Chat, {\n        sendMessage: sendMessage,\n        messageArr: messageArr,\n        chatColor: assignedColor,\n        roomId: finalRoomId,\n        playerRole: props.playerRole,\n        showChat: showChat\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 956,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 955,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ToastContainer, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 959,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true);\n}\n\n_s(Game, \"ITKDsp3iFlRCsEDOw67y69FDeIE=\", false, function () {\n  return [useScreenType, useNavigate];\n});\n\n_c = Game;\n\nvar _c;\n\n$RefreshReg$(_c, \"Game\");","map":{"version":3,"sources":["/Users/priyanshumodi/Desktop/Code/React/dot/client/src/Game.js"],"names":["logo","react","useState","useEffect","useRef","Dot","Grid","GameOver","Header","io","ToastContainer","toast","css","Chat","Route","Link","Routes","Navigate","useNavigate","useBeforeunload","useScreenType","socket","transports","Game","props","i","j","tempBoxCount","compTempPos","compBoxFlag","comp2line","elMap","setMap","Map","boxMap","setBoxMap","mapFlag","setMapFlag","boxFlag","setBoxFlag","red","blue","assignedColor","playerRole","turn","setTurn","redScore","setRedScore","blueScore","setBlueScore","gameOver","setGameOver","position","tempId","setTempId","tempColor","setTempColor","finalRoomId","setFinalRoomId","messageArr","setMessageArr","showChat","setShowChat","unreadCount","setUnreadCount","lastSeen","setLastSeen","chatRef","gridRef","chatButtonRef","yourTurnRef","gameLeaveWinner","setGameLeaveWinner","playerLeft","setPlayerLeft","playerOnMobile","setPlayerOnMobile","opponentOnMobile","setOpponentOnMobile","locationKeys","setLocationKeys","screenType","history","localTurn","movesArr","setMovesArr","showLastMove","setShowLastMove","t","tempTurn","tempBoxColor","curUrl","JSON","stringify","window","location","href","substring","length","setVsComp","console","log","socketId","tempRoomId","roomId","emit","on","updateMapWithServer","data","tempMovesArr","push","updateLocalVariablesWithServerValues","elementCheckUtilityFunction","initMap","tempGridSize","tempSize","gridSize","set","initBoxMap","updateMap","get","id","setTurnFunc","charAt","checkVerticalBoxes","checkHorizontalBoxes","elementCheck","vsComp","calcPosition","part1","part2","parseInt","stayTurn","boxColor","id1","id2","id3","id4","id5","id6","pos1","pos2","pos3","pos4","pos5","pos6","n","m","updateScore","updateTotal","tempBoxId","key","value","entries","playerColorToastId","tempVsComp","current","className","playerColor","autoClose","hideProgressBar","closeOnClick","pauseOnHover","draggable","progress","undefined","notTurnFunc","sendMessage","tempMessage","off","tempMessageArr","sender","message","tempUnreadCount","handleClickOutside","event","contains","target","document","addEventListener","removeEventListener","winner","setInterval","state","reload","pushState","name","setTimeout","visibility"],"mappings":"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A;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,QAAMwH,kBAAkB,GAAGtJ,MAAM,CAAC,IAAD,CAAjC;AACAD,EAAAA,SAAS,CAAC,MAAM;AA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","sourcesContent":["import logo from './logo.svg';\nimport './App.css';\nimport react, {useState, useEffect, useRef} from 'react';\nimport \"./style.css\";\nimport Dot from './Components/Dot';\nimport Grid from './Components/Grid';\nimport GameOver from './Components/GameOver';\nimport Header from './Components/Header';\nimport {io} from \"socket.io-client\";\nimport { ToastContainer, toast } from 'react-toastify';\nimport { css } from \"glamor\";\nimport Chat from './Components/Chat';\nimport {Route, Link, Routes, Navigate, useNavigate} from \"react-router-dom\";\nimport { useBeforeunload } from 'react-beforeunload';\nimport useScreenType from \"react-screentype-hook\";\n\nconst socket = io('https://baksa19.herokuapp.com/', { transports : ['websocket'] });\n// const socket = io('http://localhost:4000');\n\nexport default function Game(props) {\n  var i, j;\n  var tempBoxCount = 0;\n  var compTempPos;\n  var compBoxFlag = false;\n  var comp2line = false;\n  const [elMap, setMap] = useState(new Map());\n  const [boxMap, setBoxMap] = useState(new Map());\n  \n  const [mapFlag, setMapFlag] = useState(true); //used to make sure the map is initialised only once\n  const [boxFlag, setBoxFlag] = useState(true); //used to make sure the box map is initialised only once\n  \n  var red=\"#c5183b\";\n  var blue=\"#3b919b\";\n  const assignedColor = props.playerRole==1?red:blue;\n\n  const [turn, setTurn] = useState(red);\n  const [redScore, setRedScore] = useState(0);\n  const [blueScore, setBlueScore] = useState(0);\n\n  const [gameOver, setGameOver] = useState(false);\n  var position;\n  const [tempId, setTempId] = useState(\"\");\n  const [tempColor, setTempColor] = useState(\"\");\n\n  const [finalRoomId, setFinalRoomId] = useState(\"\");\n  \n  const [messageArr, setMessageArr] = useState([]);\n  const [showChat, setShowChat] = useState(false);\n  const [unreadCount, setUnreadCount] = useState(0);\n  const [lastSeen, setLastSeen] = useState(0);\n\n  const chatRef = useRef();\n  const gridRef = useRef();\n  const chatButtonRef = useRef();\n  const yourTurnRef = useRef();\n\n  const [gameLeaveWinner, setGameLeaveWinner] = useState(\"none\");\n  const [playerLeft, setPlayerLeft] = useState(false);\n  const [playerOnMobile, setPlayerOnMobile] = useState();\n  const [opponentOnMobile, setOpponentOnMobile] = useState();\n  const [ locationKeys, setLocationKeys ] = useState([])\n  const screenType = useScreenType();\n  const history = useNavigate()\n  var localTurn;\n\n  const [movesArr, setMovesArr] = useState([]);\n  const [showLastMove, setShowLastMove] = useState(false);\n\n  var t; // variable for temporarily handling id\n  var tempTurn; // variable for temporarily handling turn\n  var tempBoxColor=\"\";\n  // var tempTimeoutId;\n\n  useEffect(()=>{\n    var curUrl = JSON.stringify(window.location.href);\n    if(curUrl.substring(curUrl.length-8, curUrl.length-1)==\"offline\"){\n      props.setVsComp(true);\n    }\n  }, [])\n\n  useEffect(()=>{\n    console.log(props.socketId)\n    var tempRoomId = props.roomId+\"1\";\n    socket.emit(\"rejoin\", {roomId: tempRoomId});\n  }, [])\n\n  useEffect(()=>{\n    socket.on(\"final-room\", ({roomId})=>{\n      setFinalRoomId(roomId);\n    })\n  }, [socket]);\n\n  function updateMapWithServer(){\n    socket.emit(\"update\", {turn: tempTurn, roomId: finalRoomId, socketId: props.socketId, position: position, tempId: t, tempBoxColor: tempBoxColor});\n  }\n  \n  useEffect(()=>{\n    // console.log(socket);\n    socket.on(\"updated\", (data)=>{\n      position = data.position;\n      tempBoxColor = data.tempBoxColor;\n\n      var tempMovesArr = [...movesArr];\n      tempMovesArr.push(data.tempId);\n      setMovesArr(tempMovesArr);\n\n      updateLocalVariablesWithServerValues(data.tempId, data.turn);\n      elementCheckUtilityFunction(position, data.tempId);\n    });\n  }, [socket]);\n\n  function updateLocalVariablesWithServerValues(tempId, tempColor){\n    setTempId(tempId);\n    setTempColor(tempColor);\n    localTurn = tempColor;\n  }\n\n  (function initMap(){\n    if(mapFlag){\n      var tempGridSize;\n      var curUrl = JSON.stringify(window.location.href);\n      if(props.playerRole==2){\n        if(curUrl[curUrl.length-1]=='/'){\n          if(curUrl[curUrl.length-2]!='8'){\n            tempGridSize=4; \n          }\n          else{\n            tempGridSize=8;\n          }\n        }\n        else{\n          if(curUrl[curUrl.length-1]!='8'){\n            tempGridSize=4;\n          }\n          else{\n            tempGridSize=8;\n          }\n        }\n      }\n\n      if(props.playerRole==1){\n        var tempSize = props.gridSize==4?65:225;\n      }\n      else{\n        var tempSize = tempGridSize==4?65:225;\n      }\n      for(i=0; i<tempSize; ++i){\n        elMap.set(i, \"unclicked\");\n      }\n      setMapFlag(false);\n    }\n  })();\n\n  (function initBoxMap(){\n    if(boxFlag){\n      var tempGridSize;\n      var curUrl = JSON.stringify(window.location.href);\n      if(props.playerRole==2){\n        if(curUrl[curUrl.length-1]=='/'){\n          if(curUrl[curUrl.length-2]!='8'){\n            tempGridSize=4; \n          }\n          else{\n            tempGridSize=8;\n          }\n        }\n        else{\n          if(curUrl[curUrl.length-1]!='8'){\n            tempGridSize=4;\n          }\n          else{\n            tempGridSize=8;\n          }\n        }\n      }\n\n      if(props.playerRole==1){\n        var tempSize = props.gridSize;\n      }\n      else{\n        var tempSize = tempGridSize;\n      }\n\n      for(i=1; i<=tempSize; ++i){\n        for(j=1; j<=tempSize; ++j)\n          boxMap.set(\"b-\"+i+\"-\"+j, \"transparent\");\n      }\n      setBoxFlag(false);\n    }\n  })();\n\n  function updateMap(position){\n    if(elMap.get(position)!==\"clicked\"){\n      setMap(elMap.set(position, \"clicked\"));\n      // console.log(elMap);\n    }\n  }\n\n  function elementCheckUtilityFunction(position, id){\n    // console.log(\"here\");\n    updateMap(position);\n    setTurnFunc();\n    if(id.charAt(0) == \"h\"){\n      checkVerticalBoxes(id);\n    }\n    else{\n      checkHorizontalBoxes(id);\n    }\n  }\n\n  function elementCheck(id){\n    // console.log(tempTimeoutId)\n    // if(yourTurnRef.current.style.display===\"flex\"){\n    //   yourTurnRef.current.style.display = \"none\"\n    // }\n    // if(tempTimeoutId){\n    //   clearTimeout(tempTimeoutId);\n    // }\n    if(props.vsComp){\n      var tempMovesArr = [...movesArr];\n      tempMovesArr.push(id);\n      setMovesArr(tempMovesArr);\n    }\n    // console.log(elMap);\n    t=id;\n    tempBoxColor=\"\"\n    position = calcPosition(id);\n    // console.log(position);\n    elementCheckUtilityFunction(position, id);\n    tempTurn = turn;\n    if(!props.vsComp)\n      updateMapWithServer();\n  }\n  \n  function calcPosition(id){\n    var part1=0, part2=0, position=0;\n    if(id.charAt(0)==\"d\"){\n      part1 = 14*(parseInt(id.charAt(2))-1);\n      part2 = 2*(parseInt(id.charAt(4)))-2;\n    }\n    else if(id.charAt(0)==\"h\"){\n      part1 = 14*(parseInt(id.charAt(2))-1);\n      part2 = 2*(parseInt(id.charAt(4)))-1;\n    }\n    else{\n      part1 = 14*(parseInt(id.charAt(2)))-5;\n      part2 = parseInt(id.charAt(4));\n    }\n    position = part1 + part2;\n    // console.log(position);\n    return position;\n  }\n\n  function setTurnFunc(){\n    setTurn(turn=>turn===red?blue:red);\n    // console.log(\"In the setTurn function: \"+turn);\n  }\n\n  function stayTurn(boxColor){\n    setTurn(boxColor);\n  }\n\n  function checkVerticalBoxes(id){\n    // console.log(id);\n    var id1, id2, id3, id4, id5, id6;\n    var pos1, pos2, pos3, pos4, pos5, pos6;\n    var n = parseInt(id.charAt(2)), m = parseInt(id.charAt(4));\n    id1=\"h-\"+(n-1)+\"-\"+m;\n    id2=\"h-\"+(n+1)+\"-\"+m;\n    id3=\"v-\"+(n-1)+\"-\"+m;\n    id4=\"v-\"+(n-1)+\"-\"+(m+1);\n    id5=\"v-\"+(n)+\"-\"+m;\n    id6=\"v-\"+(n)+\"-\"+(m+1);\n    pos1=calcPosition(id1);\n    pos2=calcPosition(id2);\n    pos3=calcPosition(id3);\n    pos4=calcPosition(id4);\n    pos5=calcPosition(id5);\n    pos6=calcPosition(id6);\n    \n    if(tempBoxColor==\"\"){\n      var boxColor = turn;\n    }\n    else{\n      var boxColor = tempBoxColor;\n    }\n\n    if(elMap.get(pos1)==\"clicked\" && elMap.get(pos2)== \"clicked\" && elMap.get(pos3)==\"clicked\" && elMap.get(pos4)== \"clicked\" && elMap.get(pos5)==\"clicked\" && elMap.get(pos6)== \"clicked\"){\n        // console.log(\"upper and lower boxes filled\");\n      setBoxMap(boxMap.set((\"b-\"+(n-1)+\"-\"+m), boxColor));\n      setBoxMap(boxMap.set((\"b-\"+n+\"-\"+m), boxColor));\n      stayTurn(boxColor);\n      updateScore((\"b-\"+(n-1)+\"-\"+m));\n      updateScore((\"b-\"+n+\"-\"+m));\n      updateTotal();\n    }\n    else if(elMap.get(pos1)==\"clicked\" && elMap.get(pos3)== \"clicked\" && elMap.get(pos4)==\"clicked\"){\n        // console.log(\"upper box filled\");\n      setBoxMap(boxMap.set((\"b-\"+(n-1)+\"-\"+m), boxColor));\n      stayTurn(boxColor);\n      updateScore((\"b-\"+(n-1)+\"-\"+m));\n      updateTotal();\n    }\n    else if(elMap.get(pos2)== \"clicked\" && elMap.get(pos5)==\"clicked\" && elMap.get(pos6)== \"clicked\"){\n        // console.log(\"lower box filled\");\n      setBoxMap(boxMap.set((\"b-\"+n+\"-\"+m), boxColor));\n      stayTurn(boxColor);\n      updateScore((\"b-\"+n+\"-\"+m));\n      updateTotal();\n    }\n\n    // console.log(boxMap);\n    tempBoxColor=boxColor;\n  }\n  \n  function checkHorizontalBoxes(id){\n    // console.log(id);\n    var id1, id2, id3, id4, id5, id6;\n    var pos1, pos2, pos3, pos4, pos5, pos6;\n    var n = parseInt(id.charAt(2)), m = parseInt(id.charAt(4));\n    id1=\"h-\"+(n)+\"-\"+(m-1);\n    id2=\"v-\"+(n)+\"-\"+(m-1);\n    id3=\"h-\"+(n+1)+\"-\"+(m-1);\n    id4=\"h-\"+(n)+\"-\"+(m);\n    id5=\"v-\"+(n)+\"-\"+(m+1);\n    id6=\"h-\"+(n+1)+\"-\"+(m);\n    pos1=calcPosition(id1);\n    pos2=calcPosition(id2);\n    pos3=calcPosition(id3);\n    pos4=calcPosition(id4);\n    pos5=calcPosition(id5);\n    pos6=calcPosition(id6);\n\n    if(tempBoxColor==\"\"){\n      var boxColor = turn;\n    }\n    else{\n      var boxColor = tempBoxColor;\n    }\n\n    if(elMap.get(pos1)==\"clicked\" && elMap.get(pos2)== \"clicked\" && elMap.get(pos3)==\"clicked\" && elMap.get(pos4)== \"clicked\" && elMap.get(pos5)==\"clicked\" && elMap.get(pos6)== \"clicked\"){\n      // console.log(\"left and right boxes filled\");\n      setBoxMap(boxMap.set(\"b-\"+n+\"-\"+(m-1), boxColor));\n      setBoxMap(boxMap.set((\"b-\"+n+\"-\"+m), boxColor));\n      stayTurn(boxColor);\n      updateScore((\"b-\"+n+\"-\"+(m-1)));\n      updateScore((\"b-\"+n+\"-\"+m));\n      updateTotal();\n    }\n    else if(elMap.get(pos1)==\"clicked\" && elMap.get(pos2)== \"clicked\" && elMap.get(pos3)==\"clicked\"){\n      // console.log(\"left box filled\");\n      setBoxMap(boxMap.set(\"b-\"+n+\"-\"+(m-1), boxColor));\n      stayTurn(boxColor);\n      updateScore((\"b-\"+n+\"-\"+(m-1)));\n      updateTotal();\n    }\n    else if(elMap.get(pos4)== \"clicked\" && elMap.get(pos5)==\"clicked\" && elMap.get(pos6)== \"clicked\"){\n      // console.log(\"right box filled\");\n      setBoxMap(boxMap.set((\"b-\"+n+\"-\"+m), boxColor));\n      stayTurn(boxColor);\n      updateScore((\"b-\"+n+\"-\"+m));\n      updateTotal();\n    }\n    // console.log(boxMap);\n    tempBoxColor=boxColor;\n  }\n\n  function updateScore(tempBoxId){\n    if(boxMap.get(tempBoxId)==red){\n      setRedScore(redScore=>redScore+1);\n    }\n    else if(boxMap.get(tempBoxId)==blue){\n      setBlueScore(blueScore=>blueScore+1);\n    }\n  }\n\n  function updateTotal(){\n    tempBoxCount=0;\n    for (const [key, value] of boxMap.entries()) {\n      if(value!=\"transparent\"){\n        tempBoxCount++;\n      }\n    }\n\n    var tempGridSize;\n    var curUrl = JSON.stringify(window.location.href);\n    if(props.playerRole==2){\n      if(curUrl[curUrl.length-1]=='/'){\n        if(curUrl[curUrl.length-2]!='8'){\n          tempGridSize=4; \n        }\n        else{\n          tempGridSize=8;\n        }\n      }\n      else{\n        if(curUrl[curUrl.length-1]!='8'){\n          tempGridSize=4;\n        }\n        else{\n          tempGridSize=8;\n        }\n      }\n    }\n\n    if(props.playerRole==1){\n      if(props.gridSize == 4){\n        if(tempBoxCount == 16){\n          // console.log(boxMap);\n          console.log(\"gameover\")\n          setGameOver(true);\n        }\n      }\n      else if(props.gridSize == 8){\n        if(tempBoxCount == 64){\n          setGameOver(true);\n        }\n      }    \n    }\n    else{\n      if(tempGridSize == 4){\n        if(tempBoxCount == 16){\n          console.log(\"gameover\")\n          setGameOver(true);\n        }\n      }\n      else if(tempGridSize == 8){\n        if(tempBoxCount == 64){\n          setGameOver(true);\n        }\n      }    \n    }\n\n    console.log(boxMap);\n  }\n\n  // function compCheckVerticalBoxes(id, elRef){\n  //   // console.log(id);\n  //   var id1, id2, id3, id4, id5, id6;\n  //   var pos1, pos2, pos3, pos4, pos5, pos6;\n  //   var n = parseInt(id.charAt(2)), m = parseInt(id.charAt(4));\n  //   id1=\"h-\"+(n-1)+\"-\"+m;\n  //   id2=\"h-\"+(n+1)+\"-\"+m;\n  //   id3=\"v-\"+(n-1)+\"-\"+m;\n  //   id4=\"v-\"+(n-1)+\"-\"+(m+1);\n  //   id5=\"v-\"+(n)+\"-\"+m;\n  //   id6=\"v-\"+(n)+\"-\"+(m+1);\n  //   pos1=calcPosition(id1);\n  //   pos2=calcPosition(id2);\n  //   pos3=calcPosition(id3);\n  //   pos4=calcPosition(id4);\n  //   pos5=calcPosition(id5);\n  //   pos6=calcPosition(id6);\n    \n  //   var boxColor = turn==blue?blue:red;\n\n  //   if(elMap.get(pos1)==\"clicked\" && elMap.get(pos2)== \"clicked\" && elMap.get(pos3)==\"clicked\" && elMap.get(pos4)== \"clicked\" && elMap.get(pos5)==\"clicked\" && elMap.get(pos6)== \"clicked\"){\n  //     compBoxFlag = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //     setBoxMap(boxMap.set((\"b-\"+(n-1)+\"-\"+m), boxColor));\n  //     setBoxMap(boxMap.set((\"b-\"+n+\"-\"+m), boxColor));\n  //     stayTurn();\n  //     updateScore((\"b-\"+(n-1)+\"-\"+m));\n  //     updateScore((\"b-\"+n+\"-\"+m));\n  //     updateTotal();\n  //   }\n  //   else if(elMap.get(pos1)==\"clicked\" && elMap.get(pos3)== \"clicked\" && elMap.get(pos4)==\"clicked\"){\n  //     compBoxFlag = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //     setBoxMap(boxMap.set((\"b-\"+(n-1)+\"-\"+m), boxColor));\n  //     stayTurn();\n  //     updateScore((\"b-\"+(n-1)+\"-\"+m));\n  //     updateTotal();\n  //   }\n  //   else if(elMap.get(pos2)== \"clicked\" && elMap.get(pos5)==\"clicked\" && elMap.get(pos6)== \"clicked\"){\n  //     compBoxFlag = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //     setBoxMap(boxMap.set((\"b-\"+n+\"-\"+m), boxColor));\n  //     stayTurn();\n  //     updateScore((\"b-\"+n+\"-\"+m));\n  //     updateTotal();\n  //   }\n  // }\n\n  // function compCheckHorizontalBoxes(id, elRef){\n  //   // console.log(id);\n  //   var id1, id2, id3, id4, id5, id6;\n  //   var pos1, pos2, pos3, pos4, pos5, pos6;\n  //   var n = parseInt(id.charAt(2)), m = parseInt(id.charAt(4));\n  //   id1=\"h-\"+(n)+\"-\"+(m-1);\n  //   id2=\"v-\"+(n)+\"-\"+(m-1);\n  //   id3=\"h-\"+(n+1)+\"-\"+(m-1);\n  //   id4=\"h-\"+(n)+\"-\"+(m);\n  //   id5=\"v-\"+(n)+\"-\"+(m+1);\n  //   id6=\"h-\"+(n+1)+\"-\"+(m);\n  //   pos1=calcPosition(id1);\n  //   pos2=calcPosition(id2);\n  //   pos3=calcPosition(id3);\n  //   pos4=calcPosition(id4);\n  //   pos5=calcPosition(id5);\n  //   pos6=calcPosition(id6);\n\n  //   var boxColor = turn==blue?blue:red;\n\n  //   if(elMap.get(pos1)==\"clicked\" && elMap.get(pos2)== \"clicked\" && elMap.get(pos3)==\"clicked\" && elMap.get(pos4)== \"clicked\" && elMap.get(pos5)==\"clicked\" && elMap.get(pos6)== \"clicked\"){\n  //     compBoxFlag = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //     setBoxMap(boxMap.set(\"b-\"+n+\"-\"+(m-1), boxColor));\n  //     setBoxMap(boxMap.set((\"b-\"+n+\"-\"+m), boxColor));\n  //     stayTurn();\n  //     updateScore((\"b-\"+n+\"-\"+(m-1)));\n  //     updateScore((\"b-\"+n+\"-\"+m));\n  //     updateTotal();\n  //   }\n  //   else if(elMap.get(pos1)==\"clicked\" && elMap.get(pos2)== \"clicked\" && elMap.get(pos3)==\"clicked\"){\n  //     compBoxFlag = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //     setBoxMap(boxMap.set(\"b-\"+n+\"-\"+(m-1), boxColor));\n  //     stayTurn();\n  //     updateScore((\"b-\"+n+\"-\"+(m-1)));\n  //     updateTotal();\n  //   }\n  //   else if(elMap.get(pos4)== \"clicked\" && elMap.get(pos5)==\"clicked\" && elMap.get(pos6)== \"clicked\"){\n  //     compBoxFlag = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //     setBoxMap(boxMap.set((\"b-\"+n+\"-\"+m), boxColor));\n  //     stayTurn();\n  //     updateScore((\"b-\"+n+\"-\"+m));\n  //     updateTotal();\n  //   }\n  // }\n\n  // function compCheck1lineHorizontal(id, elRef){\n  //   console.log(id);\n  //   var id1, id2, id3, id4, id5, id6;\n  //   var pos1, pos2, pos3, pos4, pos5, pos6;\n  //   var n = parseInt(id.charAt(2)), m = parseInt(id.charAt(4));\n  //   id1=\"h-\"+(n-1)+\"-\"+m;\n  //   id2=\"h-\"+(n+1)+\"-\"+m;\n  //   id3=\"v-\"+(n-1)+\"-\"+m;\n  //   id4=\"v-\"+(n-1)+\"-\"+(m+1);\n  //   id5=\"v-\"+(n)+\"-\"+m;\n  //   id6=\"v-\"+(n)+\"-\"+(m+1);\n  //   pos1=calcPosition(id1);\n  //   pos2=calcPosition(id2);\n  //   pos3=calcPosition(id3);\n  //   pos4=calcPosition(id4);\n  //   pos5=calcPosition(id5);\n  //   pos6=calcPosition(id6);\n\n  //   if(elMap.get(pos1)==\"clicked\" && elMap.get(pos3)== \"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos1)==\"clicked\" && elMap.get(pos4)== \"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   if(elMap.get(pos3)==\"clicked\" && elMap.get(pos4)== \"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos2)== \"clicked\" && elMap.get(pos5)==\"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos2)== \"clicked\" && elMap.get(pos6)==\"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos5)== \"clicked\" && elMap.get(pos6)==\"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  // }\n\n  // function compCheck1lineVertical(id, elRef){\n  //   console.log(id);\n  //   var id1, id2, id3, id4, id5, id6;\n  //   var pos1, pos2, pos3, pos4, pos5, pos6;\n  //   var n = parseInt(id.charAt(2)), m = parseInt(id.charAt(4));\n  //   id1=\"h-\"+(n)+\"-\"+(m-1);\n  //   id2=\"v-\"+(n)+\"-\"+(m-1);\n  //   id3=\"h-\"+(n+1)+\"-\"+(m-1);\n  //   id4=\"h-\"+(n)+\"-\"+(m);\n  //   id5=\"v-\"+(n)+\"-\"+(m+1);\n  //   id6=\"h-\"+(n+1)+\"-\"+(m);\n  //   pos1=calcPosition(id1);\n  //   pos2=calcPosition(id2);\n  //   pos3=calcPosition(id3);\n  //   pos4=calcPosition(id4);\n  //   pos5=calcPosition(id5);\n  //   pos6=calcPosition(id6);\n\n  //   if(elMap.get(pos1)==\"clicked\" && elMap.get(pos2)== \"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos1)==\"clicked\" && elMap.get(pos3)== \"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   if(elMap.get(pos2)==\"clicked\" && elMap.get(pos3)== \"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos4)== \"clicked\" && elMap.get(pos5)==\"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos4)== \"clicked\" && elMap.get(pos6)==\"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  //   else if(elMap.get(pos5)== \"clicked\" && elMap.get(pos6)==\"clicked\"){\n  //     comp2line = true;\n  //     compTempPos = calcPosition(id);\n  //     elMap.set(compTempPos, \"clicked\");\n  //     elRef.current.style.backgroundColor = blue;\n  //   }\n  // }\n\n  // function compFunc(elRef){\n  //   console.log(\"computer's turn\");\n  //   console.log(elMap);\n  //   compBoxFlag = false;\n  //   var comp1line = false;\n  //   var comp0line = false;\n\n  //   if(compBoxFlag == false){\n  //     // check box completion\n  //     console.log(\"check box completion\")\n  //     for(var i=1; i<=props.gridSize+1; ++i){\n  //       for(var j=1; j<=props.gridSize; ++j){\n  //         var compTempId1 = \"h-\"+[i]+\"-\"+[j];\n  //         var compTempId2 = \"v-\"+[j]+\"-\"+[i];\n  //         while(compBoxFlag == false){\n  //           if(elMap.get(calcPosition(compTempId1))!=\"clicked\"){\n  //             compCheckVerticalBoxes(compTempId1, elRef);\n  //           }\n  //           if(elMap.get(calcPosition(compTempId2))!=\"clicked\"){\n  //             compCheckHorizontalBoxes(compTempId2, elRef);\n  //           }\n  //         }\n  //       }\n  //     }\n  //   }\n\n  //   if(compBoxFlag == false && comp1line == false && comp0line == false){\n  //     // check 0 line clicked\n  //     console.log(\"check 0 line clicked\")\n  //     for(var i=1; i<=props.gridSize+1; ++i){\n  //       for(var j=1; j<=props.gridSize; ++j){\n  //         var compTempId1 = \"h-\"+[i]+\"-\"+[j];\n  //         var compTempId2 = \"v-\"+[j]+\"-\"+[i];\n  //         while(comp0line == false){\n  //           if(elMap.get(calcPosition(compTempId1))!=\"clicked\"){\n  //             comp0line = true;\n  //             compTempPos = calcPosition(compTempId1);\n  //             elMap.set(compTempPos, \"clicked\");\n  //             elRef.current.style.backgroundColor = blue;\n  //           }\n  //           if(elMap.get(calcPosition(compTempId2))!=\"clicked\"){\n  //             comp0line = true;\n  //             compTempPos = calcPosition(compTempId2);\n  //             elMap.set(compTempPos, \"clicked\");\n  //             elRef.current.style.backgroundColor = blue;\n  //           }\n  //         }  \n  //       }\n  //     }\n  //   }\n  // }\n  \n  const playerColorToastId = useRef(null);\n  useEffect(() => {\n    var curUrl = JSON.stringify(window.location.href);\n    var tempVsComp;\n    if(curUrl.substring(curUrl.length-8, curUrl.length-1)==\"offline\"){\n      tempVsComp = true;\n    }\n    if(!tempVsComp && gridRef.current.className === \"show-grid\"){\n      var playerColor = assignedColor==\"#c5183b\"?\"Red\":\"Blue\";\n      playerColorToastId.current = toast(\"You are \"+playerColor, {\n        position: \"top-right\",\n        autoClose: 3000,\n        hideProgressBar: true,\n        closeOnClick: true,\n        pauseOnHover: false,\n        draggable: true,\n        progress: undefined,\n      });  \n    }\n  }, []);\n\n  function notTurnFunc(){\n    if(gridRef.current.className===\"show-grid\"){\n      toast(\"It's not your turn\", {\n        position: \"top-right\",\n        autoClose: 1000,\n        hideProgressBar: true,\n        closeOnClick: true,\n        pauseOnHover: false,\n        draggable: true,\n        progress: undefined,\n      }); \n    }\n  }\n\n  // const yourTurnToastId = useRef(null);\n  // useEffect(()=>{\n  //   setTimeout(()=>{\n  //     console.log(gridRef.current.className)\n  //     if(assignedColor == turn && !props.vsComp && gridRef.current.className === \"show-grid\"){\n  //       if(yourTurnToastId.current!=null){\n  //         toast.dismiss(yourTurnToastId.current)\n  //       }\n  //       setTimeout(()=>{\n  //         yourTurnToastId.current = toast(\"It's your turn\", {\n  //           position: \"top-right\",\n  //           autoClose: 5000,\n  //           hideProgressBar: true,\n  //           closeOnClick: true,\n  //           pauseOnHover: false,\n  //           draggable: true,\n  //           progress: undefined,\n  //         }); \n  //       }, 5000)\n  //     }\n  //   } , 1000)\n  // }, [turn])\n\n  function sendMessage(tempMessage, playerRole){\n    if(tempMessage==\"\"){\n        return;\n    }\n    socket.emit(\"send-message\", {roomId: finalRoomId, tempMessage: tempMessage, playerRole: playerRole});\n  }\n\n  socket.off(\"receive-message\");\n  socket.on(\"receive-message\", (tempMessage, playerRole)=>{\n      // console.log(\"message received\");\n\n      const tempMessageArr = [...messageArr];\n      tempMessageArr.push({sender: playerRole, message: tempMessage});\n      // console.log(tempMessageArr);\n      setMessageArr(tempMessageArr);\n    })\n\n    useEffect(()=>{\n      if(showChat){\n        setLastSeen(messageArr.length);\n        setUnreadCount(0);\n      }\n      var tempUnreadCount = messageArr.length-lastSeen;\n      setUnreadCount(tempUnreadCount);\n    }, [showChat])\n\n    useEffect(()=>{\n      if(showChat){\n        setUnreadCount(0);\n        setLastSeen(messageArr.length);\n      }\n      else{\n        var tempUnreadCount = messageArr.length-lastSeen;\n        setUnreadCount(tempUnreadCount);\n      }\n    }, [messageArr.length])\n\n    useEffect(() => {\n      if(showChat){\n        function handleClickOutside(event) {\n          if (chatRef.current && !chatRef.current.contains(event.target) && gridRef.current && !gridRef.current.contains(event.target) && chatButtonRef.current && !chatButtonRef.current.contains(event.target)) {\n            setShowChat(false);\n          }\n        }\n        document.addEventListener(\"mousedown\", handleClickOutside);\n        return () => {\n          document.removeEventListener(\"mousedown\", handleClickOutside);\n        };\n      }\n    }, [showChat]);\n\n    // socket.off(\"game-left\");\n    useEffect(()=>{\n      // console.log(gridRef.current.className);\n      if(!props.vsComp && gridRef.current.className === \"show-grid\"){\n        socket.on(\"game-left\", ({winner})=>{\n          // console.log(\"The other player left the game\");\n          setPlayerLeft(true);\n          setGameOver(true);\n          setGameLeaveWinner(winner);\n        })\n      }\n    }, [socket])\n\n    // useEffect(()=>{\n      // console.log(\"playerLeft: \"+playerLeft);\n      // if(playerLeft){\n      //   clearInterval(intervalId);\n      // }\n    // }, [playerLeft])\n\n    useEffect(()=>{\n      console.log(gridRef.current.className);\n      if(!props.vsComp && !playerLeft && gridRef.current.className===\"show-grid\"){\n        var tempRoomId = finalRoomId;\n        if(!playerLeft){\n          const tempId = setInterval(() => {\n            // console.log(gridRef.current.className)\n            if(gridRef.current.className === \"show-grid\"){\n              socket.emit(\"game-leave-check\", ({playerRole: props.playerRole, roomId: tempRoomId}))\n            }\n          }, 10000);\n        }\n      }\n    }, [finalRoomId, playerLeft])\n\n    window.addEventListener('popstate', (event) => {\n      if (event.state) {\n        window.location.reload();\n      }\n     }, false)\n\n    useEffect(()=>{\n      window.history.pushState({name: \"browserBack\"}, \"on browser back click\", window.location.href);\n      window.history.pushState({name: \"browserBack\"}, \"on browser back click\", window.location.href);\n    }, []);\n\n    useEffect(()=>{\n      if(showLastMove){\n        setTimeout(()=>{\n          setShowLastMove(false);\n        })\n      }\n    }, [showLastMove])\n\n    // useEffect(()=>{\n    //   if(props.playerRole==2){\n    //     console.log(\"here1\")\n    //     if(props.gridSize == 4){\n    //       if(tempBoxCount == 1){\n    //         setGameOver(true);\n    //         console.log(\"here2\")\n    //       }\n    //     }\n    //     else if(props.gridSize == 8){\n    //       if(tempBoxCount == 64){\n    //         setGameOver(true);\n    //       }\n    //     }    \n    //   }\n    // }, [socket, boxMap])\n\n  return (\n    <>\n      <Header gridSize={props.gridSize} gameOver={gameOver} fromMidGame={true} vsComp={props.vsComp}/>\n      {!gameOver?  \n        <div className=\"last-move-button\" onClick={()=>{\n          setShowLastMove(true);\n        }}>\n        </div>\n        :null\n      }\n      <div className=\"center-container\">\n        <div className={!gameOver?\"show-grid\":\"hide-grid\"} ref={gridRef}>\n          <Grid \n            gridSize={props.gridSize}\n            func={elementCheck}  \n            turn={turn} \n            map={elMap} \n            boxMap={boxMap} \n            vsComp={props.vsComp} \n            tempColor={tempColor}\n            tempId={tempId}\n            assignedColor={assignedColor}\n            notTurnFunc = {notTurnFunc}\n            showLastMove = {showLastMove}\n            setShowLastMove = {setShowLastMove}\n            movesArr = {movesArr}\n          />\n        </div>\n\n        <div className={!gameOver?\"hide-game-over\":\"show-game-over\"}>\n          <GameOver \n            gameLeaveWinner={gameLeaveWinner} \n            redScore={redScore} \n            blueScore={blueScore} \n            gridSize={props.gridSize} \n            boxMap={boxMap} \n            vsComp={props.vsComp} \n            gameOver={gameOver} \n            curRoomId={finalRoomId}\n          />\n        </div>\n        {/* {console.log(turn)} */}\n        <div className={!gameOver?\"score-container\":\"hide-score-container\"}>\n          <h2 className=\"score\" id={turn==red?\"turn-score-red\":\"score-red\"}>Red: {redScore}</h2>\n          <h2 className=\"score\" id={turn==blue?\"turn-score-blue\":\"score-blue\"}>Blue: {blueScore}</h2>\n        </div>\n        {assignedColor==turn && !gameOver && !props.vsComp? \n          <div className={assignedColor==\"#c5183b\"?\"yourTurnText-red\":\"yourTurnText-blue\"}>\n            <div className=\"baksa-image-container\">\n            </div>\n            It's your turn\n          </div>\n          :null\n        }\n      </div>\n    {!props.vsComp&&<div className={assignedColor==red?\"chat-button-container-red\":\"chat-button-container-blue\"}>\n      <div ref={chatButtonRef} className=\"chat-button\" onClick={()=>{\n        setShowChat(!showChat);\n      }\n      }>\n        <div className=\"unread-count-container\" style={{visibility: unreadCount==0?\"hidden\":\"visible\"}}>\n          {unreadCount}\n        </div>\n      </div>\n    </div>}\n    {!props.vsComp&&\n      <div ref={chatRef}>\n        <Chat sendMessage={sendMessage} messageArr={messageArr} chatColor={assignedColor} roomId={finalRoomId} playerRole={props.playerRole} showChat={showChat}/>\n      </div>\n    }\n    <ToastContainer />\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}